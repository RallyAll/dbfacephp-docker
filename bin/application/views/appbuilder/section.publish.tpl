<div class="[{$builderboxstyle}]"> <div class="box-header"> <h3 class="box-title">[{'strPublish'|translate}]</h3> </div> <div class="box-body clearfix"> <a data-widget="savedraftapp" data-style="expand-right" data-size="l" data-spinner-color="#666" class="btn btn-default ladda-button pull-left">[{'strSaveDraft'|translate}]</a> <a data-widget="previewapp" data-style="expand-left" data-size="l" data-spinner-color="#666" class="btn btn-default ladda-button pull-right">[{'strPreview'|translate}]</a> </div> <div class="box-footer"> <div class="clearfix"> <a data-widget="publishapp" data-style="expand-left" data-size="l" type="button" class="btn btn-primary ladda-button pull-right">[{'strPublish'|translate}]</a> </div> </div> </div> <div id="previewdialog"></div> <script>var lastSaveStatus=null;var lastSaveParams=null;var appstatus="[{$appinfo['status']}]";if(appstatus!="draft"&&appstatus!="publish"){appstatus="draft"}function appendDDFieldQuery(g,h){var d=null;if(h){d=$("#container_"+g+"_fields",h)}else{d=$("#container_"+g+"_fields")}var e=d.find("div[data-widget='columnnode']");var i=d.find("span[data-widget='columnmethod']");var c=new Array(e.length);var j=new Array(i.length);var b=new Array(e.length);e.each(function(a){c[a]=g+"[]="+$(this).attr("columnname");if($(this).is("[data-label]")){b[a]=g+"label[]="+$(this).attr("data-label")}else{b[a]=g+"label[]=null"}});i.each(function(a){j[a]=g+"fun[]="+$(this).html()});return c.join("&")+"&"+j.join("&")+"&"+b.join("&")}function analyticsFilterQuery(){var h=$(".sqlcondition");var f=$(".sqlop");var a=$(".sqlvalue");var d=$(".sqljoin");var l="";for(var g=0;g<h.length;g++){var k=h[g].value;var b=f[g].value;var m=a[g].value;var e=d[g].value;if(k!=""){l+="&sqlcondition[]="+k+"&sqlop[]="+b+"&sqlvalue[]="+m+"&sqljoin[]="+e}}return l}function analyticsTabular(c){var a=appendDDFieldQuery("select",c);var d=appendDDFieldQuery("order",c);var b=$("#rowlimit").val();return a+"&"+d+"&rowlimit="+b+"&"+analyticsFilterQuery()}function analyticsSummary(){var b=appendDDFieldQuery("groupby");var a=appendDDFieldQuery("summary");return b+"&"+a+"&"+analyticsFilterQuery()}function analyticsPivot(){var a=appendDDFieldQuery("column");var c=appendDDFieldQuery("row");var b=appendDDFieldQuery("pivotdata");return a+"&"+c+"&"+b+"&"+analyticsFilterQuery()}function analyticsChart(){var a=appendDDFieldQuery("xaxis");var b=appendDDFieldQuery("yaxis");return a+"&"+b+"&"+analyticsFilterQuery()}function save_app(m,f,r){var c=$("#appid").val();var j=$("#app_connid").val();var u=escapeHtml($("#app_name").val());var e=$("input:radio[name=app_categoryid]:checked").val();var l=$("#div_formbuilder").html();var b=getCleanedFormSource("#div_formbuilder");var t=escapeHtml($("#app_title").val());var p=escapeHtml($("#app_desc").val());var o=$("input:radio[name ='app_format']:checked").val();var a=$("#app_scriptType").val();var i=$("#form_option_name").val();var s=$("#form_option_loadingscript").val();var n="list";if(o=="htmlreport"){n="htmlreport"}else{if(o=="phpreport"){n="phpreport"}else{if(o=="dashboard"){n="dashboard"}else{if(o=="story"){n="story"}else{if(o=="editapp"){a=2}else{if($("#ck_sqlmode").prop("checked")){a=2}else{a=1}}}}}}var k={appid:c,apptype:n,connid:j,form_org:l,form:b,name:u,title:t,desc:p,categoryid:e,format:o,scriptType:a,form_option_name:i,form_option_loadingscript:s};var d=[];$("[option-widget]").each(function(y,z){var x=$(z).attr("option-widget");var w=$(z).val();if($(z).is(":checkbox")){if($(z).prop("checked")){k[x]=w}}else{k[x]=w}});var q="";if(n=="list"){if(a=="1"){if(o=="tabular"||o=="singlenumber"||o=="tableeditor"){q=analyticsTabular($("#summaryViewFields_tabular"))}else{if(o=="googlemap"){q=analyticsTabular($("#summaryViewFields_googlemap"))}else{if(o=="summary"){q=analyticsSummary()}else{if(o=="pivot"){q=analyticsPivot()}else{if(is_supported_chart(o)){q=analyticsChart()}}}}}q+="&"+$("#datasourceForm").serialize()}else{if(a=="2"){script=window.codepress.getValue();k.script=script}}}else{if(n=="generaloperation"){script=window.codepress.getValue();var h=CKEDITOR.instances.messageeditor.getData();k.confirm=h;k.script=script}else{if(n=="htmlreport"){script=CKEDITOR.instances.htmlreporteditor.getData();k.script=script}else{if(n=="phpreport"){script=window.phpeditor.getValue();k.script=script}else{if(n=="dashboard"){k.script="";k.script_org=""}else{if(n=="story"){var g=[];$.each($("#owl-example").find("div.item"),function(w,z){var y=$(z);var A=y.attr("data-appid");var v=y.find('a[data-name="storyname"]').html();var x=y.find('a[data-name="storydesc"]').html();g.push({appid:A,title:v,desc:x})});k.script=JSON.stringify(g);k.script_org=""}}}}}}q+="&"+$.param(k);$("input[name=userpermission]:checked").each(function(v,w){q+="&userpermission[]="+$(w).val()});if(lastSaveStatus==m&&lastSaveParams==q){if(f){f(false)}else{$.scojs_message("Application already saved!",$.scojs_message.TYPE_OK)}return}$.post("?module=Appbuilder&action="+m,q,function(w){var v=w.appid;if(v==0){if(f){f(false)}$.scojs_message(w.message,$.scojs_message.TYPE_ERROR);return}$("#appid").val(v);if(f){f(true)}if(m=="publish"){df_updatemenus()}lastSaveStatus=m;lastSaveParams=q;appstatus=m},"json").fail(function(){if(r){r()}Ladda.stopAll()})}$("a[data-widget='savedraftapp']").click(function(){var a=Ladda.create(this);a.start();save_app("draft",function(b){a.stop();if(b){$.scojs_message("Draft Saved.",$.scojs_message.TYPE_OK)}},function(){a.stop()})});$("a[data-widget='publishapp']").click(function(){if($("#app_name").val()==""){show_stack_info("Name Required",$("#app_name").attr("data-content"),"#app_name");$("#app_name").focus();return}var a=Ladda.create(this);a.start();save_app("publish",function(b){a.stop();if(b){$.scojs_message("Application Saved.",$.scojs_message.TYPE_OK)}else{$.scojs_message("Application has already Saved.",$.scojs_message.TYPE_OK)}},function(){a.stop()})});$("a[data-widget='previewapp']").click(function(){var b=$("input:radio[name ='app_format']:checked").val();if(b=="dashboard"){$("body").scrollTo("#sec_dashboardbuilder");return}if(b=="story"){$("body").scrollTo("#sec_storyreport");return}var a=Ladda.create(this);a.start();save_app(appstatus,function(c){var d=$("#appid").val();$.post("?module=App&preview=1",{appid:d},function(h){var f=$("#previewdialog").html(widgetsHelper.getEmptyWidgetHtml("preview_"+d,escapeHtml($("#app_name").val())));$(".widgetContent",f).html(h);var e=$(".widgetContent",f);$("div.dataTableFeatures",e).detach().insertAfter(e);$(".tableIcon",f).hide();var g=Math.floor($("body").width()*0.7);f.dialog({title:"Report Preview",modal:true,width:g,position:{my:"center",at:"center",of:window},resizable:true,autoOpen:true,close:function(i,j){var k=$("div.chartdiv").attr("id");if(k){if(dbface.charts&&dbface.charts[k].dispose){dbface.charts[k].dispose();dbface.charts[k]=null}}$(this).empty();$(this).dialog("destroy")}})}).always(function(){a.stop()})},function(){a.stop()})});function exitPreviewMode(){$("#previewcontent").fadeOut(function(){$("#previewcontent").html("");$("#designcontent").fadeIn()})};</script>